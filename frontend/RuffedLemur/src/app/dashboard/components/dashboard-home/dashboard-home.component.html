<!-- frontend/RuffedLemur/src/app/dashboard/components/dashboard-home/dashboard-home.component.html -->

<div class="dashboard-container">
  <h1>Certificate Dashboard</h1>
  <p class="dashboard-intro">Overview of your certificates, authorities, and upcoming expirations</p>

  <!-- Stats Widget -->
  <app-stats-widget
    [stats]="certificateStats"
    [loading]="isLoadingStats"
    [error]="statsError">
  </app-stats-widget>

  <!-- Expiring Certificates Widget -->
  <app-expiring-certs-widget
    [certificates]="expiringCertificates"
    [loading]="isLoadingExpiring"
    [error]="expiringError"
    [daysToShow]="30">
  </app-expiring-certs-widget>

  <!-- Certificates by Authority -->
  <div class="authority-section">
    <h2>Certificates by Authority</h2>

    <div *ngIf="isLoadingAuth" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
    </div>

    <div *ngIf="authError" class="error-message">
      {{ authError }}
    </div>

    <div *ngIf="!isLoadingAuth && !authError">
      <div *ngIf="certificatesByAuthority.length === 0" class="no-data-message">
        No certificate authorities configured.
      </div>

      <div *ngIf="certificatesByAuthority.length > 0" class="authority-grid">
        <mat-card *ngFor="let auth of certificatesByAuthority" class="authority-card">
          <mat-card-header>
            <mat-card-title>{{ auth.authorityName }}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="authority-stats">
              <div class="authority-count">{{ auth.count }}</div>
              <div class="authority-percentage">{{ auth.percentage }}%</div>
            </div>
            <div class="progress-container">
              <div class="progress-bar" [style.width.%]="auth.percentage"></div>
            </div>
            <div class="authority-expiry" *ngIf="auth.authorityExpirationDate">
              Expires: {{ auth.authorityExpirationDate | date:'mediumDate' }}
            </div>
          </mat-card-content>
          <mat-card-actions>
            <a mat-button color="primary" [routerLink]="['/certificates']"
               [queryParams]="{authority: auth.id}">
              View Certificates
            </a>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <h2>Quick Actions</h2>
    <div class="actions-grid">
      <a mat-raised-button color="primary" routerLink="/certificates/new">
        <mat-icon>add</mat-icon>
        Create Certificate
      </a>
      <a mat-raised-button color="accent" routerLink="/authorities/new">
        <mat-icon>security</mat-icon>
        New Authority
      </a>
      <a mat-raised-button routerLink="/certificates" [queryParams]="{expiring: 'true'}">
        <mat-icon>timer</mat-icon>
        View All Expiring
      </a>
      <a mat-raised-button routerLink="/reports/new">
        <mat-icon>assessment</mat-icon>
        Generate Report
      </a>
    </div>
  </div>
</div>
