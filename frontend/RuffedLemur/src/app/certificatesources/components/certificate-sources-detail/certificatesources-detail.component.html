<!-- src/app/certificatesources/components/certificate-source-detail/certificate-source-detail.component.html -->

<div class="source-detail-container">
  <div class="detail-header">
    <button mat-icon-button (click)="goBack()" aria-label="Back">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1>Certificate Source Details</h1>
  </div>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <div *ngIf="!isLoading && !error && source" class="source-content">
    <mat-card class="source-card">
      <mat-card-header>
        <mat-card-title>{{ source.name }}</mat-card-title>
        <mat-card-subtitle>{{ source.description || 'No description' }}</mat-card-subtitle>
        <div class="status-chip" [ngClass]="{'active-status': source.active, 'inactive-status': !source.active}">
          {{ source.active ? 'Active' : 'Inactive' }}
        </div>
      </mat-card-header>

      <mat-card-content>
        <div class="source-info">
          <div class="info-section">
            <h3>Basic Information</h3>
            <div class="info-grid">
              <div class="info-label">Name</div>
              <div class="info-value">{{ source.name }}</div>

              <div class="info-label">Plugin</div>
              <div class="info-value">{{ getPluginLabel(source.plugin) }}</div>

              <div class="info-label">Owner</div>
              <div class="info-value">{{ source.owner || 'Not specified' }}</div>

              <div class="info-label">Description</div>
              <div class="info-value">{{ source.description || 'No description' }}</div>

              <div class="info-label">Created</div>
              <div class="info-value">{{ source.createdAt ? formatDate(source.createdAt) : 'N/A' }}</div>

              <div class="info-label">Updated</div>
              <div class="info-value">{{ source.updatedAt ? formatDate(source.updatedAt) : 'N/A' }}</div>

              <div class="info-label">Status</div>
              <div class="info-value">{{ source.active ? 'Active' : 'Inactive' }}</div>
            </div>
          </div>

          <!-- Source Plugin Options -->
          <div class="info-section" *ngIf="source.pluginOptions">
            <h3>Plugin Configuration</h3>
            <div class="info-grid">
              <ng-container *ngFor="let option of source.pluginOptions | keyvalue">
                <ng-container *ngIf="option.key !== 'type' && option.value">
                  <div class="info-label">{{ option.key | titlecase }}</div>
                  <div class="info-value">
                    <!-- Hide password values -->
                    <ng-container *ngIf="option.key.toLowerCase().includes('password') ||
                                         option.key.toLowerCase().includes('secret') ||
                                         option.key.toLowerCase().includes('key') &&
                                         option.key.toLowerCase() !== 'public_key'">
                      ••••••••
                    </ng-container>
                    <ng-container *ngIf="!option.key.toLowerCase().includes('password') &&
                                         !option.key.toLowerCase().includes('secret') &&
                                         !(option.key.toLowerCase().includes('key') &&
                                           option.key.toLowerCase() !== 'public_key')">
                      {{ option.value }}
                    </ng-container>
                  </div>
                </ng-container>
              </ng-container>
            </div>
          </div>

          <!-- Source Stats -->
          <div class="info-section" *ngIf="source.active && sourceStats">
            <h3>Source Statistics</h3>
            <div class="info-grid">
              <div class="info-label">Total Certificates</div>
              <div class="info-value">{{ sourceStats.totalCertificates || 0 }}</div>

              <div class="info-label">Active Certificates</div>
              <div class="info-value">{{ sourceStats.activeCertificates || 0 }}</div>

              <div class="info-label">Expired Certificates</div>
              <div class="info-value">{{ sourceStats.expiredCertificates || 0 }}</div>

              <div class="info-label">Expiring Soon</div>
              <div class="info-value">{{ sourceStats.expiringSoonCertificates || 0 }}</div>

              <div class="info-label">Last Sync</div>
              <div class="info-value">{{ sourceStats.lastSync ? formatDate(sourceStats.lastSync) : 'Never' }}</div>
            </div>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button color="primary" (click)="editSource()">
          <mat-icon>edit</mat-icon> Edit
        </button>

        <button mat-button color="accent" (click)="toggleSourceStatus()">
          <mat-icon>{{ source.active ? 'pause' : 'play_arrow' }}</mat-icon>
          {{ source.active ? 'Deactivate' : 'Activate' }}
        </button>

        <button
          mat-button
          color="primary"
          [disabled]="!source.active || isImporting"
          (click)="importCertificates()">
          <mat-spinner *ngIf="isImporting" diameter="20"></mat-spinner>
          <mat-icon *ngIf="!isImporting">cloud_download</mat-icon>
          <span *ngIf="!isImporting">Import Certificates</span>
        </button>

        <button mat-button color="warn" (click)="deleteSource()">
          <mat-icon>delete</mat-icon> Delete
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
